#!/bin/env php
<?php

require_once __DIR__ . '/../vendor/autoload.php';

use Net\Bazzline\Component\Cli\Arguments\Arguments;
use Net\Bazzline\Component\Command\Command;

$arguments = new Arguments($argv);

try {
    $numberOfArguments          = count($arguments->getArguments());
    $hasNotAtLeastOneArgument   = ($numberOfArguments < 1);

    if ($hasNotAtLeastOneArgument) {
        $message = 'invalid number of arguments supplied';

        throw new RuntimeException($message);
    }

    $host                           = (string) $arguments->getArguments()[0];
    $invalidHostProvided            = (strlen($host) < 1);

    if ($invalidHostProvided) {
        $message = 'invalid host supplied';

        throw new RuntimeException($message);
    }

    $command = new Command();
    //@see: http://www.computerhope.com/unix/curl.htm
    $lines                  = $command('/bin/env curl -s --ssl-no-revoke -X GET ' . $host . '/unique-number-repository');
    $repositoriesAvailable  = (count($lines) > 0);

    if ($repositoriesAvailable) {
        foreach ($lines as $line) {
            $data = json_decode($line);
            echo '[name]' . "\t\t\t\t\t" . '[created at]' . "\t\t" . '[applicant name]' . PHP_EOL;
            foreach ($data as $repository) {
                echo $repository->name . "\t\t" . $repository->created_at . "\t" . $repository->applicant_name . PHP_EOL;
            }
        }
    } else {
        echo 'no repository available' . PHP_EOL;
    }
} catch (Exception $exception) {
    $usage = 'usage: ' . PHP_EOL .
        '    ' . basename(__FILE__) . ' <host>' . PHP_EOL;

    echo 'An error occurred' . PHP_EOL;
    echo $exception->getMessage() . PHP_EOL;
    echo PHP_EOL;
    echo $usage;
    exit(1);
}